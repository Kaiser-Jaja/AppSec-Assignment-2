@page
@model AppSec_Assignment_2.Pages.Account.Setup2FAModel
@{
    ViewData["Title"] = "Two-Factor Authentication Settings";
}

<div class="row justify-content-center">
  <div class="col-md-8">
<h2 class="mb-4">Two-Factor Authentication</h2>

 @if (!string.IsNullOrEmpty(Model.ErrorMessage))
     {
     <div class="alert alert-danger">
   <h5>Email Configuration Error</h5>
  <pre style="white-space: pre-wrap;">@Model.ErrorMessage</pre>
      </div>
        }

        @if (TempData["SuccessMessage"] != null)
      {
  <div class="alert alert-success">
         @TempData["SuccessMessage"]
  </div>
        }

  @if (Model.Is2FAEnabled)
        {
         <div class="alert alert-success">
 <h4><i class="bi bi-shield-check"></i> 2FA is Enabled</h4>
      <p>Your account is protected with two-factor authentication via email.</p>
      <p>When you log in, a verification code will be sent to your registered email address.</p>
            </div>

    <form method="post" asp-page-handler="Disable">
    <button type="submit" class="btn btn-warning" 
 onclick="return confirm('Are you sure you want to disable 2FA? This will make your account less secure.');">
         Disable 2FA
    </button>
  <a asp-page="/Index" class="btn btn-outline-secondary ms-2">Back to Home</a>
  </form>
        }
        else
 {
            <div class="card">
       <div class="card-body">
   <h5 class="card-title">Enable Email-Based 2FA</h5>
<p class="card-text">
  Two-factor authentication adds an extra layer of security to your account. 
When enabled, you'll receive a verification code via email each time you log in.
     </p>
            
              <div class="alert alert-info">
     <strong>How it works:</strong>
         <ol class="mb-0">
   <li>Enter your password to log in</li>
    <li>A 6-digit code will be sent to your email (@Model.MemberEmail)</li>
 <li>Enter the code to complete login</li>
</ol>
       </div>

    <form method="post">
     <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
     
          <p>Click the button below to enable 2FA. A test email will be sent to verify your email is working.</p>
        
   <button type="submit" class="btn btn-primary">Enable 2FA</button>
      <a asp-page="/Index" class="btn btn-outline-secondary ms-2">Cancel</a>
     </form>
      </div>
</div>
   }
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
