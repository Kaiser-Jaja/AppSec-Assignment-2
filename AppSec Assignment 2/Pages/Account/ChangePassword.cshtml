@page
@model AppSec_Assignment_2.Pages.Account.ChangePasswordModel
@{
    ViewData["Title"] = "Change Password";
}

<div class="row justify-content-center">
    <div class="col-md-6">
        <h2 class="mb-4">Change Password</h2>

        @if (!string.IsNullOrEmpty(Model.SuccessMessage))
   {
 <div class="alert alert-success">@Model.SuccessMessage</div>
        }

     <form method="post" id="changePasswordForm">
            <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
        <input type="hidden" name="__RequestVerificationToken" value="@Html.AntiForgeryToken()" />

       <div class="mb-3">
     <label asp-for="Input.CurrentPassword" class="form-label"></label>
      <input asp-for="Input.CurrentPassword" class="form-control" type="password" autocomplete="current-password" />
       <span asp-validation-for="Input.CurrentPassword" class="text-danger"></span>
</div>

      <div class="mb-3">
    <label asp-for="Input.NewPassword" class="form-label"></label>
     <input asp-for="Input.NewPassword" class="form-control" type="password" id="newPasswordInput" autocomplete="new-password" />
               <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
    <div id="passwordStrength" class="mt-2">
   <span id="strengthText" class="badge"></span>
     <ul id="passwordRequirements" class="small mt-1 text-muted"></ul>
        </div>
         </div>

        <div class="mb-3">
         <label asp-for="Input.ConfirmNewPassword" class="form-label"></label>
         <input asp-for="Input.ConfirmNewPassword" class="form-control" type="password" autocomplete="new-password" />
      <span asp-validation-for="Input.ConfirmNewPassword" class="text-danger"></span>
            </div>

            <div class="alert alert-info">
   <strong>Password Requirements:</strong>
      <ul class="mb-0">
   <li>Minimum 12 characters</li>
     <li>At least one lowercase letter</li>
         <li>At least one uppercase letter</li>
 <li>At least one number</li>
   <li>At least one special character</li>
     <li>Cannot reuse your last 2 passwords</li>
    </ul>
 </div>

  <div class="d-grid gap-2">
      <button type="submit" class="btn btn-primary">Change Password</button>
           <a asp-page="/Index" class="btn btn-outline-secondary">Cancel</a>
            </div>
  </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
 // Client-side password strength indicator
        document.getElementById('newPasswordInput').addEventListener('input', function() {
 const password = this.value;
 const strengthText = document.getElementById('strengthText');
            const requirementsList = document.getElementById('passwordRequirements');
        
let score = 0;
   let requirements = [];

 // Check length
        if (password.length >= 12) {
               score += 2;
       } else if (password.length >= 8) {
           score += 1;
      requirements.push('Password should be at least 12 characters');
  } else {
  requirements.push('Password must be at least 12 characters');
         }

  // Check lowercase
        if (/[a-z]/.test(password)) {
            score += 1;
       } else {
      requirements.push('Add a lowercase letter');
            }

  // Check uppercase
     if (/[A-Z]/.test(password)) {
   score += 1;
     } else {
       requirements.push('Add an uppercase letter');
 }

       // Check digit
            if (/\d/.test(password)) {
  score += 1;
    } else {
      requirements.push('Add a number');
 }

        // Check special character
 if (/[!@@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?`~]/.test(password)) {
 score += 1;
            } else {
  requirements.push('Add a special character');
     }

    // Update strength indicator
   strengthText.className = 'badge';
            if (password.length === 0) {
        strengthText.textContent = '';
     } else if (score <= 2) {
          strengthText.textContent = 'Weak';
 strengthText.classList.add('bg-danger');
 } else if (score <= 4) {
  strengthText.textContent = 'Medium';
                strengthText.classList.add('bg-warning');
   } else {
 strengthText.textContent = 'Strong';
           strengthText.classList.add('bg-success');
   }

   // Update requirements list
     requirementsList.innerHTML = requirements.map(r => '<li>' + r + '</li>').join('');
  });
    </script>
}
