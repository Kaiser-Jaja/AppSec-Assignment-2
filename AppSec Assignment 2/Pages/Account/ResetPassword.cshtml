@page
@model AppSec_Assignment_2.Pages.Account.ResetPasswordModel
@{
    ViewData["Title"] = "Reset Password";
}

<div class="row justify-content-center">
    <div class="col-md-6">
        <h2 class="mb-4">Reset Password</h2>

   @if (Model.ResetComplete)
        {
 <div class="alert alert-success">
 <h4>Password Reset Successful</h4>
     <p>Your password has been reset successfully. You can now login with your new password.</p>
  </div>
      <div class="text-center">
    <a asp-page="/Account/Login" class="btn btn-primary">Login Now</a>
   </div>
        }
        else if (Model.InvalidToken)
        {
       <div class="alert alert-danger">
     <h4>Invalid or Expired Link</h4>
  <p>This password reset link is invalid or has expired. Please request a new one.</p>
    </div>
   <div class="text-center">
          <a asp-page="/Account/ForgotPassword" class="btn btn-primary">Request New Link</a>
    </div>
        }
   else
        {
    <form method="post" id="resetPasswordForm">
   <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

    <input type="hidden" asp-for="Input.Token" />
            <input type="hidden" asp-for="Input.Email" />

    <div class="mb-3">
 <label asp-for="Input.NewPassword" class="form-label"></label>
        <input asp-for="Input.NewPassword" class="form-control" type="password" id="newPasswordInput" autocomplete="new-password" />
     <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
 <div id="passwordStrength" class="mt-2">
        <span id="strengthText" class="badge"></span>
   <ul id="passwordRequirements" class="small mt-1 text-muted"></ul>
     </div>
  </div>

   <div class="mb-3">
            <label asp-for="Input.ConfirmNewPassword" class="form-label"></label>
       <input asp-for="Input.ConfirmNewPassword" class="form-control" type="password" autocomplete="new-password" />
              <span asp-validation-for="Input.ConfirmNewPassword" class="text-danger"></span>
  </div>

       <div class="d-grid gap-2">
       <button type="submit" class="btn btn-primary">Reset Password</button>
         </div>
   </form>
 }
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
 
    @if (!Model.ResetComplete && !Model.InvalidToken)
    {
        <script>
   // Client-side password strength indicator
 document.getElementById('newPasswordInput').addEventListener('input', function() {
   const password = this.value;
  const strengthText = document.getElementById('strengthText');
      const requirementsList = document.getElementById('passwordRequirements');
        
       let score = 0;
    let requirements = [];

 if (password.length >= 12) {
      score += 2;
    } else if (password.length >= 8) {
    score += 1;
                requirements.push('Password should be at least 12 characters');
 } else {
      requirements.push('Password must be at least 12 characters');
   }

   if (/[a-z]/.test(password)) {
     score += 1;
       } else {
   requirements.push('Add a lowercase letter');
     }

    if (/[A-Z]/.test(password)) {
  score += 1;
    } else {
       requirements.push('Add an uppercase letter');
   }

  if (/\d/.test(password)) {
    score += 1;
   } else {
         requirements.push('Add a number');
            }

     if (/[!@@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?`~]/.test(password)) {
    score += 1;
 } else {
          requirements.push('Add a special character');
   }

    strengthText.className = 'badge';
   if (password.length === 0) {
   strengthText.textContent = '';
 } else if (score <= 2) {
       strengthText.textContent = 'Weak';
          strengthText.classList.add('bg-danger');
    } else if (score <= 4) {
        strengthText.textContent = 'Medium';
          strengthText.classList.add('bg-warning');
   } else {
     strengthText.textContent = 'Strong';
 strengthText.classList.add('bg-success');
            }

  requirementsList.innerHTML = requirements.map(r => '<li>' + r + '</li>').join('');
  });
     </script>
    }
}
