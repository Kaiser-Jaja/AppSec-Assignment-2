@page
@model AppSec_Assignment_2.Pages.DiagnosticsModel
@{
    ViewData["Title"] = "Email Diagnostics";
}

<div class="container mt-5">
    <h2>Email Configuration Diagnostics</h2>
  
    <div class="card mb-4">
 <div class="card-header">
    <h5>Current Configuration</h5>
     </div>
  <div class="card-body">
      <table class="table">
   <tr>
 <th>Setting</th>
          <th>Value</th>
 </tr>
   <tr>
    <td>SMTP Server</td>
  <td><code>@Model.SmtpServer</code></td>
            </tr>
          <tr>
           <td>SMTP Port</td>
 <td><code>@Model.SmtpPort</code></td>
            </tr>
        <tr>
     <td>Username</td>
      <td><code>@Model.SmtpUsername</code></td>
         </tr>
   <tr>
      <td>From Email</td>
     <td><code>@Model.FromEmail</code></td>
            </tr>
         <tr>
         <td>SSL Enabled</td>
   <td><code>@Model.EnableSsl</code></td>
      </tr>
         <tr>
    <td>Password Set</td>
      <td><code>@(Model.PasswordSet ? $"Yes ({Model.PasswordLength} chars)" : "No")</code></td>
            </tr>
        </table>
 </div>
</div>

    @if (!string.IsNullOrEmpty(Model.TestResult))
    {
        var alertClass = Model.TestSuccess ? "alert-success" : "alert-danger";
 <div class="alert @alertClass">
<h5>@(Model.TestSuccess ? "? Test Email Sent" : "? Test Failed")</h5>
<pre style="white-space: pre-wrap; font-size: 12px;">@Model.TestResult</pre>
        </div>
    }

<div class="card">
 <div class="card-body">
<h5>Send Test Email</h5>
      <form method="post">
 <div class="mb-3">
<label class="form-label">To Email Address:</label>
 <input type="email" name="testEmail" class="form-control" value="@Model.TestEmail" required />
<small class="text-muted">Enter the email address to test</small>
            </div>
  <button type="submit" class="btn btn-primary">Send Test Email</button>
    </form>
     </div>
    </div>

    <div class="alert alert-warning mt-4">
<h5>Important: Gmail App Password Setup</h5>
  <ol>
       <li>Go to <a href="https://myaccount.google.com/apppasswords" target="_blank">Google App Passwords</a></li>
        <li>Click "Generate" and select "Mail" and "Other (Custom name)"</li>
<li>Copy the 16-character password (e.g., "kuac xvsh ljnp rztw")</li>
    <li><strong>Remove ALL spaces</strong> before adding to appsettings.json: <code>kuacxvshjnprztw</code></li>
   <li>Make sure 2-Step Verification is enabled on your Google account</li>
 </ol>
    </div>

    <div class="mt-4">
  <h5>Common Issues & Solutions:</h5>
   <ul>
 <li><strong>Authentication failed:</strong> App Password has spaces or is incorrect - remove ALL spaces!</li>
  <li><strong>Connection timeout:</strong> Firewall blocking port 587 - try mobile hotspot or disable firewall temporarily</li>
        <li><strong>Server requires secure connection:</strong> Verify SSL is enabled and port is 587</li>
            <li><strong>Username/password not accepted:</strong> Make sure you're using an App Password, not your regular Gmail password</li>
  </ul>

   <p class="mt-3"><a asp-page="/Index" class="btn btn-outline-secondary">Back to Home</a></p>
  </div>
</div>
